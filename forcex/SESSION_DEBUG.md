# Отладка проблемы с сессией

## Что показывает лог

Лог `wc_logger-2026-02-02` показывает:
- ✅ **Нормальный процесс** - WooCommerce автоматически удаляет старые debug-логи
- ⚠️ **Предупреждение HTTPS** - сайт работает по HTTP вместо HTTPS

## Важно: Предупреждение HTTPS

В админке WooCommerce видно предупреждение:
> "Your store does not appear to be using a secure connection. We highly recommend serving your entire website over an HTTPS connection..."

### Почему это может быть проблемой:

1. **Cookies и сессии** - WooCommerce использует cookies для хранения сессий
2. **Безопасность** - Браузеры могут блокировать или ограничивать cookies на HTTP сайтах
3. **Локальная разработка** - На локальном сайте это нормально, но может вызывать проблемы

## Что проверить в логах

### 1. Проверьте другие логи на наличие ошибок:

В админке WooCommerce:
- **WooCommerce → Status → Logs**
- Проверьте логи с именами:
  - `fatal-errors-*` - критические ошибки
  - `place-order-debug-*` - ошибки при оформлении заказа (если есть)
  - `woocommerce-gateway-*` - ошибки платежных систем

### 2. Проверьте логи WordPress:

Если включен `WP_DEBUG`:
- Файл: `/wp-content/debug.log`
- Ищите ошибки связанные с:
  - `session`
  - `cart`
  - `checkout`
  - `WC()->cart`

## Решение для локальной разработки

### Вариант 1: Настроить HTTPS локально (рекомендуется)

Если используете Local by Flywheel или другой локальный сервер:

1. **Local by Flywheel:**
   - Откройте настройки сайта
   - Включите SSL
   - Перезапустите сайт

2. **Другие локальные серверы:**
   - Используйте HTTPS вместо HTTP
   - Установите самоподписанный SSL сертификат

### Вариант 2: Обойти проверку HTTPS для локальной разработки

Добавьте в `wp-config.php`:

```php
// Для локальной разработки - обойти проверку HTTPS
if (strpos($_SERVER['HTTP_HOST'], 'local') !== false || 
    strpos($_SERVER['HTTP_HOST'], 'localhost') !== false) {
    $_SERVER['HTTPS'] = 'off';
}
```

## Дополнительная отладка

### Включите debug-логи WooCommerce:

1. **WooCommerce → Settings → Advanced → Logging**
2. Включите логирование для:
   - Checkout
   - Payment gateways
   - Sessions

### Проверьте cookies в браузере:

1. Откройте DevTools (F12)
2. Перейдите на вкладку **Application** (Chrome) или **Storage** (Firefox)
3. Проверьте **Cookies**
4. Ищите cookies начинающиеся с:
   - `woocommerce_`
   - `wp_woocommerce_`
   - `wc_session_`

### Проверьте консоль браузера:

1. Откройте DevTools (F12)
2. Перейдите на вкладку **Console**
3. Ищите ошибки связанные с:
   - Cookies
   - Session
   - CORS
   - Security

## Что делать дальше

1. ✅ Проверьте другие логи на наличие ошибок
2. ✅ Проверьте cookies в браузере
3. ✅ Попробуйте включить HTTPS локально
4. ✅ Проверьте консоль браузера на ошибки

## Если проблема сохраняется

Соберите следующую информацию:

1. **Логи WooCommerce:**
   - Все логи из `WooCommerce → Status → Logs`
   - Особенно логи с ошибками

2. **Логи браузера:**
   - Скриншот консоли (F12 → Console)
   - Скриншот Network tab при оформлении заказа

3. **Информация о системе:**
   - Версия WordPress
   - Версия WooCommerce
   - Локальный сервер (Local, XAMPP, и т.д.)
   - Браузер и версия

## Примечание

Лог, который вы показали (`place-order-debug-*` был удален) - это **нормально**. WooCommerce автоматически очищает старые debug-логи. Это не ошибка, а стандартная процедура обслуживания.
