# Исправление ошибки "Session Expired" при оформлении заказа

## Проверка настроек в админке WordPress/WooCommerce

### 1. Проверка метода оплаты BACS (Direct Bank Transfer)

**Путь:** WooCommerce → Settings → Payments

1. Откройте **WooCommerce → Settings → Payments**
2. Найдите **"Direct Bank Transfer"** (BACS)
3. Убедитесь, что метод **включен** (Enabled)
4. Нажмите **"Manage"** рядом с методом
5. Проверьте настройки:
   - ✅ **Enable/Disable** - должно быть включено
   - ✅ **Title** - название метода (например, "Direct Bank Transfer")
   - ✅ **Description** - описание для клиентов
   - ✅ **Instructions** - инструкции по оплате

**Важно:** Метод должен быть включен и настроен, иначе он не будет отображаться на странице оформления заказа.

---

### 2. Проверка страниц WooCommerce

**Путь:** WooCommerce → Settings → Advanced → Page Setup

1. Откройте **WooCommerce → Settings → Advanced**
2. Перейдите на вкладку **"Page Setup"**
3. Проверьте, что все страницы назначены:
   - ✅ **Cart page** - страница корзины
   - ✅ **Checkout page** - страница оформления заказа
   - ✅ **My account page** - страница личного кабинета
   - ✅ **Terms and conditions page** - страница условий (если используется)

**Важно:** Если страница оформления заказа не назначена, WooCommerce не сможет правильно обработать заказ.

---

### 3. Проверка настроек сессий WooCommerce

**Путь:** WooCommerce → Settings → Advanced → Checkout

1. Откройте **WooCommerce → Settings → Advanced**
2. Перейдите на вкладку **"Checkout"**
3. Проверьте настройки:
   - ✅ **Enable guest checkout** - может быть включено или выключено (по желанию)
   - ✅ **Enable checkout login reminder** - по желанию
   - ✅ **Enable registration on checkout** - по желанию

**Важно:** Эти настройки влияют на то, как WooCommerce обрабатывает сессии пользователей.

---

### 4. Проверка настроек магазина

**Путь:** WooCommerce → Settings → General

1. Откройте **WooCommerce → Settings → General**
2. Проверьте основные настройки:
   - ✅ **Store Address** - адрес магазина должен быть заполнен
   - ✅ **Currency** - валюта установлена правильно
   - ✅ **Selling Locations** - страны, в которые вы продаете

---

### 5. Проверка методов доставки

**Путь:** WooCommerce → Settings → Shipping

1. Откройте **WooCommerce → Settings → Shipping**
2. Убедитесь, что настроена хотя бы одна **Shipping Zone**
3. В зоне доставки должен быть добавлен хотя бы один метод доставки:
   - Flat Rate (фиксированная ставка)
   - Free Shipping (бесплатная доставка)
   - Local Pickup (самовывоз)
   - Или другой метод доставки

**Важно:** Без настроенных методов доставки оформление заказа может не работать корректно.

---

### 6. Проверка логов ошибок

**Путь:** WooCommerce → Status → Logs

1. Откройте **WooCommerce → Status → Logs**
2. Проверьте наличие ошибок, связанных с:
   - Checkout
   - Payment
   - Session
   - BACS

**Важно:** Логи могут показать точную причину проблемы.

---

## Быстрая проверка настроек

Выполните следующие действия в админке:

### ✅ Чеклист проверки:

1. **WooCommerce → Settings → Payments**
   - [ ] Метод "Direct Bank Transfer" (BACS) включен
   - [ ] Настройки метода заполнены

2. **WooCommerce → Settings → Advanced → Page Setup**
   - [ ] Страница оформления заказа назначена
   - [ ] Страница корзины назначена
   - [ ] Страница личного кабинета назначена

3. **WooCommerce → Settings → Shipping**
   - [ ] Настроена хотя бы одна зона доставки
   - [ ] В зоне доставки есть хотя бы один метод доставки

4. **WooCommerce → Settings → General**
   - [ ] Адрес магазина заполнен
   - [ ] Валюта установлена

5. **WooCommerce → Status → Logs**
   - [ ] Проверены логи на наличие ошибок

---

## Что делать после проверки настроек

1. **Очистите кеш:**
   - Если используете плагин кеширования, очистите его
   - Очистите кеш браузера (Ctrl+Shift+Delete)

2. **Проверьте в режиме инкогнито:**
   - Откройте браузер в режиме инкогнито
   - Попробуйте оформить заказ снова

3. **Проверьте сессию:**
   - Убедитесь, что cookies включены в браузере
   - Попробуйте другой браузер

4. **Проверьте права доступа:**
   - Убедитесь, что файлы WordPress имеют правильные права доступа
   - Проверьте права на папку `/wp-content/uploads/`

---

## Дополнительные настройки (если проблема сохраняется)

### Проверка PHP сессий

Если проблема связана с сессиями PHP, проверьте в `wp-config.php`:

```php
// Убедитесь, что нет конфликтов с сессиями
// WooCommerce использует свои собственные сессии через cookies
```

### Проверка плагинов

Отключите другие плагины временно и проверьте, не конфликтуют ли они:
1. Отключите все плагины кроме WooCommerce
2. Попробуйте оформить заказ
3. Если работает - включайте плагины по одному, чтобы найти конфликт

---

## Контакты для поддержки

Если проблема сохраняется после всех проверок:
1. Проверьте логи: **WooCommerce → Status → Logs**
2. Проверьте логи WordPress (если WP_DEBUG включен)
3. Проверьте консоль браузера (F12) на наличие JavaScript ошибок

---

## Примечания

- Метод BACS автоматически включается через код темы (функция `forcex_enable_payment_methods`)
- Заказы с методом BACS автоматически помечаются как оплаченные для тестирования
- Сессии WooCommerce хранятся в cookies, а не в PHP сессиях
